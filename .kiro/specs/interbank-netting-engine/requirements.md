# 요구사항 문서

## 개요

은행간 상계 엔진은 부채 토큰화와 주기적 상계를 통해 실시간 사용자 지급을 가능하게 하면서 은행간 정산을 지연시키고 최적화하는 하이브리드 블록체인 시스템입니다. 이 시스템은 Cosmos Hub를 중앙 청산 엔진으로 사용하고 개별 은행 운영을 위해 Hyperledger Besu 네트워크를 사용하며, 은행간 실제 자금 이동을 최소화하기 위해 발행자 기반 신용 토큰 모델을 구현합니다.

## 용어집

- **Cosmos_Hub**: 신용 토큰과 상계 작업을 관리하는 Cosmos SDK 기반 중앙 청산 엔진
- **Besu_Network**: 개별 은행이 운영하는 Hyperledger Besu 프라이빗 블록체인 네트워크
- **Credit_Token**: 은행간 IOU를 나타내는 `cred-{BankID}` 형식의 은행별 부채 토큰
- **Gateway_Contract**: 토큰을 소각하고 이체 이벤트를 발생시키는 소스 Besu 네트워크의 스마트 컨트랙트
- **Executor_Contract**: 검증된 명령에 기반하여 토큰을 발행하는 목적지 Besu 네트워크의 스마트 컨트랙트
- **Netting_Process**: 정산을 최소화하기 위한 은행간 상호 부채의 주기적 교차 상쇄
- **Oracle_Module**: 검증자 합의를 통해 외부 블록체인 이벤트를 검증하는 Cosmos 모듈
- **Relayer**: Cosmos Hub와 Besu 네트워크 간 이벤트와 명령을 전송하는 오프체인 서비스

## 요구사항

### 요구사항 1

**사용자 스토리:** 은행 고객으로서, 다른 은행 고객에게 즉시 송금하고 싶습니다. 은행간 정산 지연을 기다리지 않고 거래를 완료할 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 사용자가 은행간 이체를 시작하면 THEN Gateway_Contract는 송신자 계정에서 지정된 금액을 즉시 소각해야 합니다
2. WHEN 소스 체인에서 토큰이 소각되면 THEN 시스템은 송신자, 수신자, 금액, 논스가 포함된 TransferInitiated 이벤트를 발생시켜야 합니다
3. WHEN 이체가 합의로 검증되면 THEN Executor_Contract는 목적지 체인의 수신자 계정에 정확한 금액을 발행해야 합니다
4. WHEN 발행이 발생하면 THEN 수신자는 해당 체인에서 한 블록 확인 내에 토큰을 받아야 합니다
5. WHEN 이체가 완료되면 THEN 시스템은 모든 체인에서 소각된 금액과 발행된 금액 간의 1:1 대응을 유지해야 합니다

### 요구사항 2

**사용자 스토리:** 참여 은행으로서, 다른 은행에 대한 부채를 신용 토큰으로 추적하고 싶습니다. 은행간 의무를 투명하고 효율적으로 관리할 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 은행간 이체가 검증되면 THEN Cosmos_Hub는 이체 금액과 동일한 `cred-{SourceBankID}` 형식의 신용 토큰을 발행해야 합니다
2. WHEN 신용 토큰이 발행되면 THEN 시스템은 이를 목적지 은행의 Cosmos 계정으로 전송해야 합니다
3. WHEN 신용 토큰이 존재하면 THEN 각 토큰은 발행 은행의 부채 의무 정확히 한 단위를 나타내야 합니다
4. WHEN 신용 잔액을 조회하면 THEN 시스템은 모든 은행 쌍 간의 정확한 부채 포지션을 반환해야 합니다
5. WHEN 신용 토큰이 생성되면 THEN 시스템은 원래 이체의 불변 기록을 유지해야 합니다

### 요구사항 3

**사용자 스토리:** 시스템 운영자로서, 외부 블록체인 이벤트가 합의를 통해 검증되기를 원합니다. 합법적인 이체만 처리되도록 보장할 수 있기 위해서입니다.

#### 수용 기준

1. WHEN 임의의 Besu_Network에서 TransferInitiated 이벤트가 발생하면 THEN Oracle_Module은 검증자들로부터 투표를 수집해야 합니다
2. WHEN 검증자들이 투표를 제출하면 THEN 시스템은 이벤트 확인을 위해 3분의 2 과반수를 요구해야 합니다
3. WHEN 합의에 도달하면 THEN Oracle_Module은 이체를 최종 확정으로 표시하고 신용 토큰 발행을 트리거해야 합니다
4. WHEN 충분하지 않은 투표가 수신되면 THEN 시스템은 이체를 거부하고 현재 상태를 유지해야 합니다
5. WHEN 투표 검증이 발생하면 THEN 시스템은 등록된 공개 키를 사용하여 각 검증자의 서명을 확인해야 합니다

### 요구사항 4

**사용자 스토리:** 참여 은행으로서, 상호 부채가 주기적으로 자동 상계되기를 원합니다. 실제 자금 이체를 최소화하고 정산 비용을 줄일 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 10블록마다 상계 주기가 트리거되면 THEN Netting_Process는 모든 은행의 신용 토큰 잔액을 스캔해야 합니다
2. WHEN 은행간 상호 신용 토큰이 존재하면 THEN 시스템은 최소 중복 금액을 계산해야 합니다
3. WHEN 상계 계산이 완료되면 THEN 시스템은 양 은행의 신용 토큰 보유량에서 계산된 금액을 소각해야 합니다
4. WHEN 상계 중 신용 토큰이 소각되면 THEN 시스템은 이전 및 이후 잔액과 함께 NettingCompleted 이벤트를 발생시켜야 합니다
5. WHEN 상계가 완료되면 THEN 시스템은 영향받은 모든 은행의 순 부채 포지션을 정확하게 업데이트해야 합니다

### 요구사항 5

**사용자 스토리:** 은행 운영자로서, 발행 명령이 여러 검증자에 의해 서명되기를 원합니다. 크로스체인 지급 지시의 진위를 신뢰할 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 검증된 이체가 발행을 요구하면 THEN 시스템은 수신자와 금액 세부사항이 포함된 발행 명령을 생성해야 합니다
2. WHEN 발행 명령이 생성되면 THEN Cosmos_Hub는 활성 검증자들로부터 ECDSA 서명을 수집해야 합니다
3. WHEN 서명이 수집되면 THEN 시스템은 검증자의 최소 3분의 2로부터 서명을 요구해야 합니다
4. WHEN Executor_Contract가 명령을 받으면 THEN ecrecover 프리컴파일을 사용하여 모든 서명을 검증해야 합니다
5. WHEN 서명 검증이 실패하면 THEN Executor_Contract는 발행 명령을 거부하고 현재 상태를 유지해야 합니다

### 요구사항 6

**사용자 스토리:** 시스템 관리자로서, 검증자 세트가 안전하게 관리되기를 원합니다. 네트워크가 발전함에 따라 시스템 무결성을 유지할 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 검증자 세트 업데이트가 발생하면 THEN 시스템은 연결된 모든 Besu_Networks에 변경사항을 전파해야 합니다
2. WHEN 새로운 검증자가 참여하면 THEN 시스템은 Executor_Contract를 그들의 공개 키로 업데이트해야 합니다
3. WHEN 검증자가 제거되면 THEN 시스템은 모든 체인에서 그들의 서명 권한을 취소해야 합니다
4. WHEN 검증자 세트가 변경되면 THEN 시스템은 3분의 2 서명 임계값 요구사항을 유지해야 합니다
5. WHEN 검증자 업데이트가 완료되면 THEN 모든 체인은 서명 검증을 위해 동일한 검증자 세트를 사용해야 합니다

### 요구사항 7

**사용자 스토리:** 컴플라이언스 담당자로서, 모든 거래와 상계 작업이 불변으로 기록되기를 원합니다. 시스템 운영을 감사하고 규제 준수를 확인할 수 있도록 하기 위해서입니다.

#### 수용 기준

1. WHEN 임의의 이체가 발생하면 THEN 시스템은 타임스탬프와 참여자를 포함한 완전한 거래 세부사항을 기록해야 합니다
2. WHEN 상계 작업이 실행되면 THEN 시스템은 영향받은 모든 은행의 이전 및 이후 신용 토큰 잔액을 기록해야 합니다
3. WHEN 신용 토큰이 발행되거나 소각되면 THEN 시스템은 원래 이체에 대한 완전한 추적성을 가진 이벤트를 발생시켜야 합니다
4. WHEN 감사 쿼리가 수행되면 THEN 시스템은 지정된 기간에 대한 완전한 거래 이력을 제공해야 합니다
5. WHEN 시스템 상태가 변경되면 THEN 모든 수정사항은 블록체인 기록을 통해 암호학적으로 검증 가능해야 합니다
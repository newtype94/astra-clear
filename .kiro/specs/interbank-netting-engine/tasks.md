# 구현 계획

- [x] 1. 프로젝트 구조 및 개발 환경 설정





- [x] 1.1 전체 프로젝트 디렉토리 구조 생성


  - cosmos/ (Cosmos Hub 코드)
  - contracts/ (Solidity 스마트 컨트랙트)
  - relayer/ (오프체인 릴레이어)
  - besu-networks/ (Besu 네트워크 설정)
  - docker/ (Docker 구성 파일)
  - scripts/ (배포 및 설정 스크립트)
  - _요구사항: 전체 시스템 아키텍처_

- [x] 1.2 Hyperledger Besu 로컬 네트워크 설정


  - Bank A 네트워크 (포트 8545, P2P 30303)
  - Bank B 네트워크 (포트 8546, P2P 30304)
  - Genesis 블록 및 계정 설정
  - Docker Compose 구성 파일 작성
  - _요구사항: 1.1, 1.2_

- [x] 1.3 Cosmos SDK 앱 초기화


  - Go 모듈 설정 및 의존성 관리
  - 기본 앱 구조 생성
  - 커스텀 모듈 등록 준비
  - _요구사항: 2.1, 3.1_

- [x] 1.4 기본 타입 및 인터페이스 정의


  - 공통 데이터 구조 정의
  - 모듈 간 인터페이스 설계
  - 테스트 프레임워크 설정 (gopter 포함)
  - _요구사항: 1.1, 2.1, 3.1_

- [x] 2. Cosmos Hub 핵심 모듈 구현




- [x] 2.1 x/oracle 모듈 기본 구조 구현


  - 모듈 스켈레톤 및 키퍼 생성
  - Vote 및 VoteStatus 타입 정의
  - 기본 메시지 핸들러 구현
  - _요구사항: 3.1, 3.2_

- [x] 2.2 속성 테스트 작성 - 합의 메커니즘


  - **속성 6: 합의 메커니즘**
  - **검증: 요구사항 3.1, 3.2, 3.3, 3.4**


- [x] 2.3 x/netting 모듈 기본 구조 구현

  - 모듈 스켈레톤 및 키퍼 생성
  - CreditToken 및 NettingCycle 타입 정의
  - 신용 토큰 발행/소각 로직 구현
  - _요구사항: 2.1, 2.2, 4.1_

- [x] 2.4 속성 테스트 작성 - 신용 토큰 발행 및 전송


  - **속성 3: 신용 토큰 발행 및 전송**
  - **검증: 요구사항 2.1, 2.2**

- [x] 2.5 x/multisig 모듈 기본 구조 구현


  - 모듈 스켈레톤 및 키퍼 생성
  - ValidatorSet 및 MintCommand 타입 정의
  - ECDSA 서명 생성/검증 로직 구현
  - _요구사항: 5.1, 5.2, 6.1_

- [x] 2.6 속성 테스트 작성 - 서명 검증


  - **속성 7: 서명 검증**
  - **검증: 요구사항 3.5**

- [ ] 3. 합의 및 투표 시스템 구현
- [ ] 3.1 Oracle 모듈 투표 수집 로직 구현
  - MsgVote 메시지 핸들러 완성
  - 투표 상태 관리 및 저장
  - 검증자 서명 검증 로직
  - _요구사항: 3.1, 3.5_

- [ ] 3.2 합의 달성 및 이벤트 확정 로직 구현
  - 2/3 과반수 합의 검증
  - 이체 최종 확정 처리
  - 신용 토큰 발행 트리거
  - _요구사항: 3.2, 3.3_

- [ ] 3.3 합의 실패 처리 로직 구현
  - 불충분한 투표 처리
  - 상태 유지 및 거부 로직
  - 오류 이벤트 발생
  - _요구사항: 3.4_

- [ ] 3.4 단위 테스트 작성 - 투표 및 합의
  - 투표 수집 테스트
  - 합의 달성/실패 시나리오 테스트
  - 서명 검증 테스트
  - _요구사항: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 4. 신용 토큰 관리 시스템 구현
- [ ] 4.1 신용 토큰 발행 로직 구현
  - cred-{BankID} 형식 토큰 생성
  - 목적지 은행 계정으로 전송
  - 원본 이체 기록 연결
  - _요구사항: 2.1, 2.2, 2.5_

- [ ] 4.2 신용 잔액 조회 시스템 구현
  - 은행별 부채 포지션 계산
  - 실시간 잔액 조회 API
  - 은행 쌍 간 부채 관계 조회
  - _요구사항: 2.4_

- [ ] 4.3 속성 테스트 작성 - 신용 잔액 조회 정확성
  - **속성 4: 신용 잔액 조회 정확성**
  - **검증: 요구사항 2.4**

- [ ] 4.4 속성 테스트 작성 - 신용 토큰 추적성
  - **속성 5: 신용 토큰 추적성**
  - **검증: 요구사항 2.5**

- [ ] 5. 상계(Netting) 엔진 구현
- [ ] 5.1 주기적 상계 트리거 구현
  - EndBlocker에서 10블록마다 실행
  - 모든 은행 신용 토큰 잔액 스캔
  - 상계 대상 식별
  - _요구사항: 4.1_

- [ ] 5.2 속성 테스트 작성 - 주기적 상계 트리거
  - **속성 8: 주기적 상계 트리거**
  - **검증: 요구사항 4.1**

- [ ] 5.3 상계 계산 로직 구현
  - 상호 신용 토큰 매칭
  - 최소 중복 금액 계산
  - 상계 가능 금액 결정
  - _요구사항: 4.2_

- [ ] 5.4 상계 실행 로직 구현
  - 계산된 금액만큼 토큰 소각
  - 양방향 동시 소각 처리
  - 원자적 트랜잭션 보장
  - _요구사항: 4.3_

- [ ] 5.5 속성 테스트 작성 - 상계 계산 및 실행
  - **속성 9: 상계 계산 및 실행**
  - **검증: 요구사항 4.2, 4.3**

- [ ] 5.6 상계 완료 후 처리 구현
  - 순 부채 포지션 업데이트
  - NettingCompleted 이벤트 발생
  - 이전/이후 잔액 기록
  - _요구사항: 4.4, 4.5_

- [ ] 5.7 속성 테스트 작성 - 상계 완료 후 상태 업데이트
  - **속성 10: 상계 완료 후 상태 업데이트**
  - **검증: 요구사항 4.4, 4.5**

- [ ] 6. Relayer 시스템 구현
- [ ] 6.1 Besu 이벤트 모니터링 구현
  - WebSocket 연결을 통한 실시간 이벤트 감지
  - TransferInitiated 이벤트 파싱
  - 이벤트 필터링 및 검증
  - _요구사항: 1.2, 3.1_

- [ ] 6.2 Cosmos Hub 메시지 전송 구현
  - MsgVote 트랜잭션 생성 및 전송
  - 가스 추정 및 수수료 관리
  - 트랜잭션 상태 추적
  - _요구사항: 3.1_

- [ ] 6.3 Cosmos 이벤트 모니터링 구현
  - Cosmos 블록 및 이벤트 구독
  - MintCommand 이벤트 감지
  - 서명된 명령 수집
  - _요구사항: 5.1, 5.2_

- [ ] 6.4 Besu 명령 실행 구현
  - Executor 컨트랙트 호출
  - 서명 검증 및 전송
  - 실행 결과 확인
  - _요구사항: 5.4, 5.5_

- [ ] 6.5 Relayer 오류 처리 및 재시도 로직
  - 네트워크 연결 실패 처리
  - 지수 백오프 재시도 메커니즘
  - 실패한 트랜잭션 추적 및 복구
  - _설계 문서: 오류 처리 섹션_

- [ ] 6.6 단위 테스트 작성 - Relayer 시스템
  - 이벤트 모니터링 테스트
  - 메시지 전송 테스트
  - 오류 처리 시나리오 테스트
  - _요구사항: 1.2, 3.1, 5.1_

- [ ] 7. 체크포인트 - 모든 테스트 통과 확인
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 문의합니다.

- [ ] 8. 다중 서명 시스템 구현
- [ ] 8.1 발행 명령 생성 로직 구현
  - 검증된 이체에서 발행 명령 생성
  - 수신자 및 금액 세부사항 포함
  - 명령 ID 생성 및 관리
  - _요구사항: 5.1_

- [ ] 8.2 ECDSA 서명 수집 로직 구현
  - 활성 검증자로부터 서명 수집
  - 2/3 임계값 검증
  - 서명 집계 및 저장
  - _요구사항: 5.2, 5.3_

- [ ] 8.3 속성 테스트 작성 - 다중 서명 프로세스
  - **속성 11: 다중 서명 프로세스**
  - **검증: 요구사항 5.1, 5.2, 5.3**

- [ ] 9. Hyperledger Besu 스마트 컨트랙트 구현
- [ ] 9.1 Gateway.sol 컨트랙트 구현
  - sendToChain 함수 구현
  - 토큰 소각 로직
  - TransferInitiated 이벤트 발생
  - _요구사항: 1.1, 1.2_

- [ ] 9.2 속성 테스트 작성 - 토큰 소각 및 이벤트 발생
  - **속성 1: 토큰 소각 및 이벤트 발생**
  - **검증: 요구사항 1.1, 1.2**

- [ ] 9.3 Executor.sol 컨트랙트 구현
  - executeMint 함수 구현
  - ecrecover를 사용한 서명 검증
  - 토큰 발행 로직
  - _요구사항: 1.3, 5.4, 5.5_

- [ ] 9.4 속성 테스트 작성 - 스마트 컨트랙트 서명 검증
  - **속성 12: 스마트 컨트랙트 서명 검증**
  - **검증: 요구사항 5.4, 5.5**

- [ ] 9.5 검증자 세트 관리 기능 구현
  - updateValidatorSet 함수 구현
  - 검증자 추가/제거 로직
  - 임계값 유지 검증
  - _요구사항: 6.1, 6.2, 6.3, 6.4_

- [ ] 9.6 속성 테스트 작성 - 검증자 세트 동기화
  - **속성 13: 검증자 세트 동기화**
  - **검증: 요구사항 6.1, 6.2, 6.3, 6.4, 6.5**

- [ ] 10. 시스템 통합 및 1:1 대응 보장
- [ ] 10.1 크로스체인 이체 완료 플로우 구현
  - Gateway에서 Executor까지 전체 플로우
  - 소각-발행 원자성 보장
  - 실패 시 롤백 메커니즘
  - _요구사항: 1.3, 1.4_

- [ ] 10.2 속성 테스트 작성 - 이체 완료 시 1:1 대응
  - **속성 2: 이체 완료 시 1:1 대응**
  - **검증: 요구사항 1.5**

- [ ] 11. 감사 및 로깅 시스템 구현
- [ ] 11.1 거래 로깅 시스템 구현
  - 모든 이체 세부사항 기록
  - 타임스탬프 및 참여자 정보 포함
  - 불변 로그 저장
  - _요구사항: 7.1_

- [ ] 11.2 상계 감사 로깅 구현
  - 상계 전후 잔액 기록
  - 영향받은 은행 목록 저장
  - 상계 결과 추적
  - _요구사항: 7.2_

- [ ] 11.3 추적성 이벤트 시스템 구현
  - 토큰 발행/소각 시 추적성 이벤트 발생
  - 원본 이체와의 연결 정보 포함
  - 완전한 감사 체인 구성
  - _요구사항: 7.3_

- [ ] 11.4 속성 테스트 작성 - 감사 로깅
  - **속성 14: 감사 로깅**
  - **검증: 요구사항 7.1, 7.2, 7.3**

- [ ] 11.5 감사 쿼리 API 구현
  - 기간별 거래 이력 조회
  - 필터링 및 정렬 기능
  - 완전한 거래 세부사항 제공
  - _요구사항: 7.4_

- [ ] 11.6 속성 테스트 작성 - 감사 쿼리
  - **속성 15: 감사 쿼리**
  - **검증: 요구사항 7.4**

- [ ] 12. 오류 처리 및 복구 메커니즘 구현
- [ ] 12.1 네트워크 오류 처리 구현
  - Relayer 재시도 로직 (지수 백오프)
  - 부분 실패 시 체인별 독립 상태 관리
  - 타임아웃 설정 및 데드락 방지
  - _설계 문서: 오류 처리 섹션_

- [ ] 12.2 합의 실패 처리 구현
  - 불충분한 투표 시 이벤트 거부
  - 검증자 오프라인 시 동적 임계값 조정
  - 서명 오류 시 개별 서명 제외 처리
  - _설계 문서: 오류 처리 섹션_

- [ ] 12.3 상계 오류 처리 구현
  - 계산 오류 시 상태 복원
  - 부분 소각 실패 시 전체 롤백
  - 동시성 문제 해결 (블록 높이 기반 순차 처리)
  - _설계 문서: 오류 처리 섹션_

- [ ] 12.4 스마트 컨트랙트 오류 처리 구현
  - 자동 가스 추정 및 여유분 추가
  - 서명 검증 실패 시 명령 거부 및 로깅
  - 검증자 세트 불일치 감지 및 동기화
  - _설계 문서: 오류 처리 섹션_

- [ ] 12.5 단위 테스트 작성 - 오류 처리
  - 네트워크 오류 시나리오 테스트
  - 합의 실패 케이스 테스트
  - 상계 오류 복구 테스트
  - 스마트 컨트랙트 오류 처리 테스트
  - _설계 문서: 오류 처리 섹션_

- [ ] 13. 최종 체크포인트 - 모든 테스트 통과 확인
  - 모든 테스트가 통과하는지 확인하고, 문제가 있으면 사용자에게 문의합니다.
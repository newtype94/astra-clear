# Architecture

<details>
<summary><b>ğŸ‡ºğŸ‡¸ English</b></summary>

## 1. System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ASTRA CLEAR NETWORK                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   BANK A        â”‚                              â”‚   BANK B        â”‚       â”‚
â”‚  â”‚   (Besu Chain)  â”‚                              â”‚   (Besu Chain)  â”‚       â”‚
â”‚  â”‚                 â”‚                              â”‚                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         RELAYER              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ Gateway   â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ Gateway   â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ Executor  â”‚â—€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ Executor  â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ BankToken â”‚  â”‚              â”‚               â”‚  â”‚ BankToken â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚   COSMOS HUB    â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚  Oracle   â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚  Netting  â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚ Multisig  â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Component Responsibilities

### Cosmos Hub Modules

| Module | Responsibility |
|--------|---------------|
| **x/oracle** | Cross-chain event voting & consensus |
| **x/netting** | Credit token management & bilateral netting |
| **x/multisig** | Signature aggregation & threshold verification |

### Smart Contracts

| Contract | Responsibility |
|----------|---------------|
| **Gateway.sol** | Burn tokens + emit transfer event |
| **Executor.sol** | Verify signatures + mint tokens |
| **BankToken.sol** | ERC20 stablecoin implementation |

### Relayer

- Stateless event relay
- Circuit breaker pattern
- Exponential backoff retry

---

## 3. Cross-Chain Transfer Flow

```
User A          Bank A (Besu)         Cosmos Hub         Bank B (Besu)         User B
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚ 1. Transfer      â”‚                     â”‚                   â”‚                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚             2. Burn Token              â”‚                   â”‚                  â”‚
  â”‚             + Emit Event               â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚  3. Submit Vote     â”‚                   â”‚                  â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               4. Validators Vote        â”‚                  â”‚
  â”‚                  â”‚                  (2/3 threshold)        â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               5. Record IOU             â”‚                  â”‚
  â”‚                  â”‚               (cred-BankA)              â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               6. Generate               â”‚                  â”‚
  â”‚                  â”‚               Mint Command              â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚  7. Execute Mint  â”‚                  â”‚
  â”‚                  â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚            8. Verify + Mint         â”‚
  â”‚                  â”‚                     â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
```

---

## 4. Netting Flow

```
                              COSMOS HUB
                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   cred-A      â”‚    â”‚   cred-B      â”‚    â”‚   cred-C      â”‚
    â”‚   Balances    â”‚    â”‚   Balances    â”‚    â”‚   Balances    â”‚
    â”‚               â”‚    â”‚               â”‚    â”‚               â”‚
    â”‚ Bank B: 100   â”‚    â”‚ Bank A: 30    â”‚    â”‚ Bank A: 50    â”‚
    â”‚ Bank C: 50    â”‚    â”‚ Bank C: 20    â”‚    â”‚ Bank B: 40    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   NETTING     â”‚
                         â”‚   PROCESS     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼            â–¼            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ A â†” B     â”‚ â”‚ A â†” C     â”‚ â”‚ B â†” C     â”‚
            â”‚ Net: Aâ†’B  â”‚ â”‚ Net: 0    â”‚ â”‚ Net: Bâ†’C  â”‚
            â”‚      70   â”‚ â”‚           â”‚ â”‚      20   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. State Machines

### Transfer State

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PENDING   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Vote submitted
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   VOTING    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚      â”‚
 2/3 ok  Timeout  Rejected
    â”‚      â”‚      â”‚
    â–¼      â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚CONFIRMâ”‚ â”‚EXPIREDâ”‚ â”‚REJECT â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Mint executed
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚COMPLETEâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Netting Cycle State

```
â”Œâ”€â”€â”€â”€â”€â”€â”     Trigger     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDLE â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚COLLECTING â”‚
â””â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â–²                          â”‚
    â”‚                          â–¼
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚CALCULATINGâ”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â–¼                       â–¼
    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚ EXECUTING â”‚           â”‚ ROLLBACK  â”‚
    â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚             â–¼                       â–¼
    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”‚ COMPLETED â”‚           â”‚  FAILED   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Security Model

### Trust Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TRUST BOUNDARY                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚   TRUSTED                    UNTRUSTED          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚   â€¢ Validator Set            â€¢ External Users   â”‚
â”‚   â€¢ Bank Operators           â€¢ Network Layer    â”‚
â”‚   â€¢ Smart Contracts          â€¢ Relayer          â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Signature Flow

```
         MESSAGE HASH
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Val 1 â”‚ â”‚ Val 2 â”‚ â”‚ Val 3 â”‚
â”‚ Sign  â”‚ â”‚ Sign  â”‚ â”‚ Sign  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚         â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   AGGREGATED    â”‚
     â”‚   SIGNATURES    â”‚
     â”‚   (2/3 + 1)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    EXECUTOR     â”‚
     â”‚    VERIFY       â”‚
     â”‚  (ecrecover)    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Error Recovery

| Layer | Error | Recovery |
|-------|-------|----------|
| Network | Timeout | Exponential backoff |
| Network | RPC fail | Circuit breaker |
| Consensus | Insufficient votes | Dynamic threshold |
| Netting | Calculation error | Snapshot rollback |
| Contract | Gas error | 20% buffer + retry |

</details>

<details open>
<summary><b>ğŸ‡°ğŸ‡· í•œêµ­ì–´</b></summary>

## 1. ì‹œìŠ¤í…œ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ASTRA CLEAR NETWORK                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   BANK A        â”‚                              â”‚   BANK B        â”‚       â”‚
â”‚  â”‚   (Besu Chain)  â”‚                              â”‚   (Besu Chain)  â”‚       â”‚
â”‚  â”‚                 â”‚                              â”‚                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         RELAYER              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ Gateway   â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ Gateway   â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ Executor  â”‚â—€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚ Executor  â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚ BankToken â”‚  â”‚              â”‚               â”‚  â”‚ BankToken â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚   COSMOS HUB    â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚  Oracle   â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚  Netting  â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚                          â”‚  â”‚ Multisig  â”‚  â”‚                                â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì»´í¬ë„ŒíŠ¸ ì—­í• 

### Cosmos Hub ëª¨ë“ˆ

| ëª¨ë“ˆ | ì—­í•  |
|------|------|
| **x/oracle** | í¬ë¡œìŠ¤ì²´ì¸ ì´ë²¤íŠ¸ íˆ¬í‘œ ë° í•©ì˜ |
| **x/netting** | ì‹ ìš© í† í° ê´€ë¦¬ ë° ì–‘ë°©í–¥ ìƒê³„ |
| **x/multisig** | ì„œëª… ì§‘ê³„ ë° ì„ê³„ê°’ ê²€ì¦ |

### ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸

| ì»¨íŠ¸ë™íŠ¸ | ì—­í•  |
|----------|------|
| **Gateway.sol** | í† í° Burn + ì „ì†¡ ì´ë²¤íŠ¸ ë°œìƒ |
| **Executor.sol** | ì„œëª… ê²€ì¦ + í† í° Mint |
| **BankToken.sol** | ERC20 ìŠ¤í…Œì´ë¸”ì½”ì¸ êµ¬í˜„ |

### Relayer

- Stateless ì´ë²¤íŠ¸ ì¤‘ê³„
- Circuit breaker íŒ¨í„´
- Exponential backoff ì¬ì‹œë„

---

## 3. í¬ë¡œìŠ¤ì²´ì¸ ì „ì†¡ íë¦„

```
User A          Bank A (Besu)         Cosmos Hub         Bank B (Besu)         User B
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚ 1. ì†¡ê¸ˆ ìš”ì²­     â”‚                     â”‚                   â”‚                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚             2. í† í° Burn               â”‚                   â”‚                  â”‚
  â”‚             + ì´ë²¤íŠ¸ ë°œìƒ              â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚  3. íˆ¬í‘œ ì œì¶œ       â”‚                   â”‚                  â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               4. Validator íˆ¬í‘œ         â”‚                  â”‚
  â”‚                  â”‚                  (2/3 ì„ê³„ê°’)           â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               5. IOU ê¸°ë¡               â”‚                  â”‚
  â”‚                  â”‚               (cred-BankA)              â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚               6. Mint ëª…ë ¹              â”‚                  â”‚
  â”‚                  â”‚                  ìƒì„±                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚  7. Mint ì‹¤í–‰     â”‚                  â”‚
  â”‚                  â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
  â”‚                  â”‚                     â”‚            8. ê²€ì¦ + Mint            â”‚
  â”‚                  â”‚                     â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                  â”‚                     â”‚                   â”‚                  â”‚
```

---

## 4. Netting íë¦„

```
                              COSMOS HUB
                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   cred-A      â”‚    â”‚   cred-B      â”‚    â”‚   cred-C      â”‚
    â”‚   ì”ì•¡        â”‚    â”‚   ì”ì•¡        â”‚    â”‚   ì”ì•¡        â”‚
    â”‚               â”‚    â”‚               â”‚    â”‚               â”‚
    â”‚ Bank B: 100   â”‚    â”‚ Bank A: 30    â”‚    â”‚ Bank A: 50    â”‚
    â”‚ Bank C: 50    â”‚    â”‚ Bank C: 20    â”‚    â”‚ Bank B: 40    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   NETTING     â”‚
                         â”‚   ì²˜ë¦¬        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼            â–¼            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ A â†” B     â”‚ â”‚ A â†” C     â”‚ â”‚ B â†” C     â”‚
            â”‚ ìˆœì±„ë¬´:   â”‚ â”‚ ìˆœì±„ë¬´: 0 â”‚ â”‚ ìˆœì±„ë¬´:   â”‚
            â”‚ Aâ†’B 70    â”‚ â”‚           â”‚ â”‚ Bâ†’C 20    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ìƒíƒœ ë¨¸ì‹ 

### ì „ì†¡ ìƒíƒœ

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ëŒ€ê¸° ì¤‘    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚ íˆ¬í‘œ ì œì¶œ
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  íˆ¬í‘œ ì¤‘    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚      â”‚
 2/3 ë‹¬ì„±  íƒ€ì„ì•„ì›ƒ  ê±°ë¶€
    â”‚      â”‚      â”‚
    â–¼      â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ í™•ì •  â”‚ â”‚ ë§Œë£Œ  â”‚ â”‚ ê±°ë¶€  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Mint ì‹¤í–‰
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì™„ë£Œ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Netting ì‚¬ì´í´ ìƒíƒœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”     íŠ¸ë¦¬ê±°     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ëŒ€ê¸°ì¤‘â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ì”ì•¡ ìˆ˜ì§‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â–²                          â”‚
    â”‚                          â–¼
    â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚ ê³„ì‚° ì¤‘   â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â–¼                       â–¼
    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚  ì‹¤í–‰ ì¤‘  â”‚           â”‚  ë¡¤ë°± ì¤‘  â”‚
    â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚             â–¼                       â–¼
    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”‚   ì™„ë£Œ    â”‚           â”‚   ì‹¤íŒ¨    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ë³´ì•ˆ ëª¨ë¸

### ì‹ ë¢° ê²½ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ì‹ ë¢° ê²½ê³„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚   ì‹ ë¢°ë¨                     ë¹„ì‹ ë¢°             â”‚
â”‚   â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€             â”‚
â”‚   â€¢ Validator ì§‘í•©           â€¢ ì™¸ë¶€ ì‚¬ìš©ì      â”‚
â”‚   â€¢ ì€í–‰ ìš´ì˜ì              â€¢ ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ    â”‚
â”‚   â€¢ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸          â€¢ Relayer          â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œëª… íë¦„

```
         ë©”ì‹œì§€ í•´ì‹œ
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Val 1 â”‚ â”‚ Val 2 â”‚ â”‚ Val 3 â”‚
â”‚ ì„œëª…  â”‚ â”‚ ì„œëª…  â”‚ â”‚ ì„œëª…  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚         â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   ì§‘ê³„ëœ ì„œëª…   â”‚
     â”‚   (2/3 + 1)     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    EXECUTOR     â”‚
     â”‚    ê²€ì¦         â”‚
     â”‚  (ecrecover)    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ì˜¤ë¥˜ ë³µêµ¬

| ê³„ì¸µ | ì˜¤ë¥˜ | ë³µêµ¬ ë°©ë²• |
|------|------|----------|
| ë„¤íŠ¸ì›Œí¬ | íƒ€ì„ì•„ì›ƒ | Exponential backoff |
| ë„¤íŠ¸ì›Œí¬ | RPC ì‹¤íŒ¨ | Circuit breaker |
| í•©ì˜ | íˆ¬í‘œ ë¶€ì¡± | Dynamic threshold |
| Netting | ê³„ì‚° ì˜¤ë¥˜ | ìŠ¤ëƒ…ìƒ· ë¡¤ë°± |
| ì»¨íŠ¸ë™íŠ¸ | ê°€ìŠ¤ ì˜¤ë¥˜ | 20% ë²„í¼ + ì¬ì‹œë„ |

</details>
